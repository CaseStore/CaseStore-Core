{#
# @license 3-clause BSD
# @link https://github.com/CaseStore/CaseStore-Core
#}

{% extends 'CaseStoreBundle::base.html.twig' %}

{% block main %}

    <ol class="breadcrumb">
        <li><a href="{{ path('case_store_project', { 'projectId':project.publicId }) }}">Project {{  project.title }}</a></li>
        <li><a href="{{  path('case_store_case_study', { 'projectId':project.publicId, 'caseStudyId':caseStudy.publicId }) }}">Case Study</a></li>
        <li class="active">Edit Locations</li>
    </ol>

    <div id="Map" style="width: 100%; height: 300px;"></div>

    <div id="AddNewWrapper" style="display:none;">
        <form action="#" method="post">
            <input type="hidden" name="action" value="add">
            <input type="hidden" name="lat" value="">
            <input type="hidden" name="lng" value="">
            <input type="submit" value="Add this location">
        </form>
    </div>

{%  endblock %}

{% block javascript %}
    <script>
        var mapObject;
        var mapData = [];
        {%  for location in locations %}
        mapData.push({ lat: {{  location.lat}}, lng: {{  location.lng }} });
        {%  endfor %}
        $( document ).ready(function() {
            mapObject = L.map('Map').setView([57.04199, -3.55957], 6);

            var mapquestUrl = 'http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png',
                    subDomains = ['otile1','otile2','otile3','otile4'],
                    mapquestAttrib = 'Data, imagery and map information provided by <a href="http://open.mapquest.co.uk" target="_blank">MapQuest</a>, '+
                            '<a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> and contributors';
            L.tileLayer(mapquestUrl, {maxZoom: 18, attribution: mapquestAttrib, subdomains: subDomains}).addTo(mapObject);

            for (idx in mapData) {
                L.marker([ mapData[idx].lat, mapData[idx].lng]).addTo(mapObject);
            }

            mapObject.on('click', function(e) {
                $('#AddNewWrapper form input[name="lat"]').val(e.latlng.lat);
                $('#AddNewWrapper form input[name="lng"]').val(e.latlng.lng);
                $('#AddNewWrapper').show();
            });

        });
    </script>
{% endblock %}


